# ------------------------------------------------------------------
# SODA SOP TEMPLATE v1.3
# ------------------------------------------------------------------
sop_meta:
  id: "SOP-{{ID}}"
  name: "{{NOME_DO_PROCEDIMENTO}}" # Ex: TDD Cycle
  phase: "{{FASE_DO_CICLO}}" # Ex: Phase 5 (Execution)
  version: "1.3"
  responsible_role: "@{{PERSONA}}" # Ex: @architect, @qa_lead, @code_agent

# CONTRATO DE DEPEND√äNCIAS (O que o agente precisa LER)
inputs:
  mandatory:
    - path: "docs/previous_sop_output.md"
      description: "A sa√≠da do SOP anterior √© a verdade imut√°vel."
  context:
    - path: "docs/business/glossary.md"
      description: "Para garantir consist√™ncia sem√¢ntica."
    - path: "PROJECT_CHARTER.md"
      description: "Para alinhamento estrat√©gico."

# CONTRATO DE ENTREGA (O que o agente precisa CRIAR)
outputs:
  primary:
    path: "docs/current_sop_output.md"
    format: "markdown" # ou yaml, json, sql, py
    template: "templates/{{TIPO}}_template.md"
  side_effects:
    - "Update task_plan.md status to DONE"
    - "Create GitHub Issue if blockers found"

# CONFIGURA√á√ÉO DO MOTOR DE EXECU√á√ÉO (RALPH)
execution_config:
  max_iterations: 15
  tools_allowed: ["tool_A", "tool_B"] # Sandbox de ferramentas
  validation_script: ".agent/scripts/validators/validate_{{ID}}.py"

# CORPO DO PROCEDIMENTO (INSTRU√á√ïES PARA O LLM)
instructions: |
  ## 1. Objetivo Prim√°rio
  {{DESCRICAO_DO_OBJETIVO}}

  ## 2. Protocolo de Execu√ß√£o (Algorithm)
  1. **Ingest√£o:** Leia todos os arquivos listados em `inputs`. Se algum arquivo obrigat√≥rio estiver faltando, ABORTAR IMEDIATAMENTE e solicitar interven√ß√£o humana.
  2. **An√°lise:** Compare o pedido atual com as restri√ß√µes do `PROJECT_CHARTER.md`.
  3. **Processamento:**
     - Passo 3.1: {{ACAO_ESPECIFICA_1}}
     - Passo 3.2: {{ACAO_ESPECIFICA_2}}
  4. **Verifica√ß√£o:** Antes de salvar, execute o script de valida√ß√£o.

  ## 3. Guardrails (Restri√ß√µes Negativas)
  - ‚õî **MUST NOT:** Inventar dados n√£o presentes nos inputs.
  - ‚õî **MUST NOT:** Violar a terminologia do Gloss√°rio.
  - ‚ö†Ô∏è **WARNING:** Se encontrar ambiguidade, pergunte ao humano. N√£o assuma.
  - üëÆ **GIT LAW:** Commit changes to branch 'feat/{{ID}}'. Never main.

  ## 4. Definition of Done (DoD)
  - [ ] O arquivo de sa√≠da existe no caminho especificado.
  - [ ] O conte√∫do passa no validador sint√°tico.
  - [ ] O `task_plan.md` foi atualizado.
